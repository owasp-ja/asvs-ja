# V50 Web フロントエンドセキュリティ

このカテゴリはアプリケーションの Web フロントエンドを介して実行される攻撃から保護する要件に焦点を当てています。これらの要件はマシン間ソリューションには関係ありません。

## V1.50 Web フロントエンドセキュリティドキュメント

アプリケーションドキュメントには、必要なブラウザのセキュリティ機能を明記しなければなりません。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.50.1** | [追加] アプリケーションドキュメントには、アプリケーションを使用するブラウザがサポートする必要がある想定されるセキュリティ機能 (HTTPS、HSTS、コンテンツセキュリティポリシー (CSP)、その他の関連する HTTP セキュリティメカニズムなど) を記載している。これらの機能の一部が利用できない場合にアプリケーションがどのように動作しなければならないか (ユーザへの警告やアクセスのブロックなど) も定義する必要がある。| | | ✓ | |

## V50.1 サイト分離アーキテクチャ

同一オリジン分離の利点を活用するには、アプリケーションは個別のホスト名でホストする必要があります。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.1.1** | [追加, 3.4.5 を廃止] あるオリジンでロードされたドキュメントやスクリプトが別のオリジンのリソースとやり取りする方法や、Cookie のホスト名制限など、同一オリジンポリシーによって提供される制限を活用するために、別のアプリケーションは異なるホスト名でホストされている。 | ✓ | ✓ | ✓ | 668 |

## V50.2 クッキーセットアップ

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.2.1** | [修正, 3.4.1 から移動] クッキーには 'Secure' 属性が設定されており、クッキー名に '\__Host-' プレフィックスが使用されていない場合は、クッキー名に '__Secure-' プレフィックスを使用しなければならない。 | ✓ | ✓ | ✓ | 614 |
| **50.2.2** | [修正, 3.4.2 から移動, レベル L1 > L2] クッキーの値がクライアントサイドスクリプトからアクセスされることを意図していない場合 (セッショントークンなど)、クッキーは 'HttpOnly' 属性が設定されていなければならず、同じ値 (セッショントークンなど) は 'Set-Cookie' ヘッダフィールドを介してのみクライアントに転送されなければならない。 | | ✓ | ✓ | 1004 |
| **50.2.3** | [修正, 3.4.3 から移動, レベル L1 > L2] 各クッキーの 'SameSite' 属性値はクッキーの目的に応じて設定され、クロスサイトリクエストフォージェリ攻撃やユーザインタフェースレドレス攻撃への露出を制限している。 | | ✓ | ✓ | 1275 |
| **50.2.4** | [修正, 3.4.4 から移動, レベル L1 > L2] クッキーは、明示的に他のホストと共有するように設計されていない限り、クッキー名に '__Host-' プレフィックスを付けている。 | | ✓ | ✓ | |
| **50.2.5** | [追加] アプリケーションが Cookie を書き込む際、Cookie 名と値を合わせた長さは 4096 バイトを超えない。大きすぎる Cookie はブラウザに保存されないため、リクエストとともに送信されず、ユーザはその Cookie に依存するアプリケーション機能を使用できなくなる。 | | ✓ | ✓ | |

## V50.3 ブラウザのセキュリティメカニズムヘッダ

HTTP レスポンスには、ブラウザがコンテンツを安全にレンダリングするためのルールを設定するセキュリティヘッダを含めなければなりません。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.3.1** | [修正, 14.4.3 から移動, レベル L1 > L2] すべての HTTP レスポンスには Content-Security-Policy ヘッダを含み、悪意のある JavaScript のリスクを軽減している。ディレクティブ object-src 'none' および base-uri 'none' を定義しなければならない。L3 アプリケーションでは、ナンスまたはハッシュを用いたレスポンスごとのポリシーを定義しなければならない。 | | ✓ | ✓ | |
| **50.3.2** | [文法, 14.4.4 から移動] すべてのレスポンスに X-Content-Type-Options: nosniff ヘッダフィールドが含まれている。 | ✓ | ✓ | ✓ | 116 |
| **50.3.3** | [修正, 14.4.5 から移動] Strict-Transport-Security ヘッダフィールドがすべてのレスポンスとすべてのサブドメインに含まれている。例えば、Strict-Transport-Security：max-age=31536000; includeSubdomains | ✓ | ✓ | ✓ | 523 |
| **50.3.4** | [修正, 14.4.6 から移動] 適切な Referrer-Policy ヘッダが含まれており、URL 内の機密情報が Referer ヘッダを介して信頼できないパーティに公開されることを防いでいる。 | ✓ | ✓ | ✓ | 116 |
| **50.3.5** | [修正, 14.4.7 から移動] デフォルトでは Web アプリケーションのコンテンツはサードパーティサイトに埋め込むことができず、Content-Security-Policy frame-ancestors ディレクティブを使用して、必要な場合にのみ特定のリソースの埋め込みが許可される。X-Frame-Options は現在廃止されていることに注意する。 | ✓ | ✓ | ✓ | 1021 |
| **50.3.6** | [追加, 14.5.3 から分割] クロスオリジンリソース共有 (CORS) Access-Control-Allow-Origin ヘッダフィールドが信頼できるオリジンの厳密な許可リストに対して検証されている。 "Access-Control-Allow-Origin: *" を使用する必要がある場合、レスポンスに機密情報が含まれていない。 | ✓ | ✓ | ✓ | 183 |
| **50.3.7** | [追加] Content-Security-Policy ヘッダフィールドが違反を報告する場所を指定している。 | | | ✓ | |
| **50.3.8** | [追加] アプリケーションのトップレベルドメイン (例: site.tld) がパブリック HSTS プリロードリストに追加され、アプリケーションの TLS の使用が、関連する HTTP レスポンスヘッダフィールドのみに依存するのではなく、メインブラウザに直接組み込まれる。 | | | ✓ | |

## V50.4 ブラウザのオリジン分離

サーバサイドでリクエストを受け入れる際、アプリケーション自体あるいは信頼できるパーティによって開始されたものであることを確認する必要があります。

ここでのキーワードは JavaScript の Same Origin Policy や Cookie の SameSite ロジックなどのブラウザのセキュリティポリシーです。

カテゴリには以下のアイデアでの要件を含む必要があります。

* リクエストが信頼できるパーティにより開始されたこと (CSRF, CORS 構成ミス)
* レスポンスは信頼できるパーティのみに読み取れること (CORS 構成ミス)

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.4.1** | [修正, 4.2.2 から移動, 13.2.3 からマージ] アプリケーションがクロスサイトリクエストフォージェリ (CSRF) 攻撃を防御し、認証された機能や機密性の高い公開機能を保護するために、開発フレームワークに組み込まれた CSRF 対策機能や CSRF トークンと追加の多層防御をともに使用している。 | ✓ | ✓ | ✓ | 352 |
| **50.4.2** | [追加] メッセージのオリジンが信頼できない場合、またはメッセージの構文が無効な場合、postMessage インタフェースによって受信したメッセージを破棄している。 | | ✓ | ✓ | 346 |
| **50.4.3** | [追加, 14.5.3 から分割] Origin ヘッダフィールドが目的のクロスオリジンリソース共有 (CORS) ポリシーを満たすために、許可されたオリジンの定義済みリストに対して妥当性確認されている。 | ✓ | ✓ | ✓ | 346 |

## V50.5 クロスサイトスクリプトインクルージョン

JSONP はデータ窃取につながる可能性のあるアンチパターンです。機密データを含むスクリプトの認可が不十分だと、クロスサイトスクリプティングインクルージョン (XSSI) 攻撃につながる可能性があります。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.5.1** | [追加] クロスサイトスクリプトインクルージョン (XSSI) 攻撃を避けるために、JSONP 機能はアプリケーションのどの部分でも有効になっていない。 | ✓ | ✓ | ✓ | |
| **50.5.2** | [追加] クロスサイトスクリプトインクルージョン (XSSI) 攻撃を防ぐために、認可が必要なデータは JavaScript ファイルなどのスクリプトリソースレスポンスには含まれていない。 | ✓ | ✓ | ✓ | |

## V50.6 意図しないコンテンツ解釈

コンテンツや機能を不適切なコンテンツでレンダリングすると、さまざまなセキュリティ問題につながる可能性があります。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.6.1** | [修正, 12.5.2 から移動, 1.12.2, 14.4.2 からマージ] ブラウザが不正なコンテキスト (API、ユーザがアップロードしたファイル、または他のリソースが直接リクエストされる場合など) で HTTP レスポンスのコンテンツや機能をレンダリングすることを防ぐために、セキュリティ制御が行われている。可能な制御には、HTTP リクエストヘッダフィールドが、Sec-Fetch-\* など、正しいコンテキストであることを示さない限りコンテンツを提供しない Content-Security-Policy: sandbox, Content-Disposition: attachment などが含まれる。 | ✓ | ✓ | ✓ | |
| **50.6.2** | [追加, 5.3.3 から分割] コンテンツをテキストとして表示するのではなく HTML として実行するなど、意図しないコンテンツの実行を避けるために、信頼できないデータを処理するときには JavaScript コンテキストを意識した手法を使用している。 | ✓ | ✓ | ✓ | |

## V50.7 外部リソース完全性

サードパーティのサイトでコンテンツをホストすると、悪意のあるコンテンツ改変やサプライチェーン攻撃につながる可能性があります。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.7.1** | [修正, 14.2.3 から移動] JavaScript ライブラリ、CSS、Web フォントなどのクライアントサイド資産がコンテンツ配信ネットワーク（Content Delivery Network, CDN）または外部プロバイダで外部的にホストされている場合、資産の整合性を検証するためにサブリソース完全性（SRI）が使用されている。 | ✓ | ✓ | ✓ | 829 |

## V50.8 ブラウザのセキュリティに関するその他の考慮事項

<!--
it may need other separate section for "end-user protection via UI"
-->

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **50.8.1** | [追加, 5.1.5 から分割] ユーザがアプリケーションの制御外の URL にリダイレクトされる場合、アプリケーションはナビゲーションをキャンセルするオプションとともに通知を表示している。 | | | ✓ | |
| **50.8.2** | [修正, 1.14.6 から移動] アプリケーションは依然としてサポートされており安全であると考えられているクライアント側テクノロジのみを使用している。この要件を満たさないテクノロジの例としては NSAPI プラグイン、Flash、Shockwave、ActiveX、Silverlight、NACL、またはクライアントサイドの Java アプレットなどがある。 | | ✓ | ✓ | 477 |
| **50.8.3** | [追加] アプリケーションへのアクセスに使用されるブラウザが、想定されるセキュリティ機能をサポートしていない場合、アプリケーションはドキュメントに記載されているとおりに動作する (ユーザへの警告やアクセスのブロックなど)。 | | | ✓ | |

## 参考情報

詳しくは以下の情報を参照してください。

* [Set-Cookie __Host- prefix details](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#cookie_prefixes)
* [OWASP Content Security Policy Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html)
* [Exploiting CORS misconfiguration for BitCoins and Bounties](https://portswigger.net/blog/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)
* [Sandboxing third-party components](https://cheatsheetseries.owasp.org/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html#sandboxing-content)
* [OWASP Secure Headers Project](https://owasp.org/www-project-secure-headers/)
* [OWASP Cross-Site Request Forgery Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
* [HSTS Browser Preload List submission form](https://hstspreload.org/)
