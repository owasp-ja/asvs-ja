# V1 セキュリティ決定ドキュメント

## 管理目標

この段落には、実装とテストの前提条件となるドキュメント要件が含まれています。

ここでのドキュメント要件は一時的な解決策であり、リリースでどのように整理するかはまだ決まっていないことに注意してください。ドキュメント要件であるかどうかに関わらず、要件は削除または移動される可能性があります。
<!--
セキュリティアーキテクチャは多くの組織で失われた技術となっています。エンタープライズアーキテクトの時代は DevSecOps で過去のものとなりました。アプリケーションセキュリティの分野では、最新のセキュリティアーキテクチャの原則をソフトウェア実務者に再導入しながら、アジャイルセキュリティの原則をキャッチアップし採用する必要があります。アーキテクチャは実装ではなく、潜在的に多くの異なる答えがある可能性があり、唯一の「正しい」答えがない問題について考える方法です。多くの場合、開発者がその問題を解決するはるかに優れた方法を知っている可能性がある場合には、セキュリティは柔軟性がなく、開発者が特定の方法でコードを修正することを要求するものとみなされます。アーキテクチャに対して唯一で単純な解決策はありません。そして、そうではないフリをすることはソフトウェアエンジニアリング分野への害となります。

Web アプリケーションの特定の実装はそのライフタイムを通じて継続的に改訂される可能性がありますが、全体的なアーキテクチャはほとんど変更されず、ゆっくりと進化します。セキュリティアーキテクチャも同様です。私たちは今日認証が必要ですし、明日も認証が必要でしょうし、五年後にも必要でしょう。今日、妥当な判断を下して、アーキテクチャに準拠したソリューションを選択して再利用すれば、多くの労力、時間、費用を節約できます。例えば、一昔前には、多要素認証はほとんど実装されていませんでした。

開発者が SAML フェデレーションアイデンティティなどの単一のセキュアなアイデンティティプロバイダモデルに注力した場合、元のアプリケーションのインタフェースを変更することなく、NIST SP 800-63 コンプライアンスなどの新しい要件を組み込むためにそのアイデンティティプロバイダを更新できることでしょう。多くのアプリケーションが同じセキュリティアーキテクチャ、つまり同じコンポーネントを共有している場合、すべてのアプリケーションが同時にこのアップグレードの利を得られます。但し、SAML は常に最適な認証ソリューションとしてあり続けるとは限りません。要件変更に応じて他のソリューションと交換する必要があるかもしれません。このような変更は互いに入り組んでおり、完全な書き直しが必要になるほどコストがかかるか、セキュリティアーキテクチャなしではまったく不可能となります。

本章では、ASVS は妥当なセキュリティアーキテクチャの主要な側面である可用性、機密性、処理の完全性、否認防止、プライバシーをカバーしています。これらの各セキュリティ原則はすべてのアプリケーションに組み込まれ、本質的に備わったものでなければなりません。「シフトレフト」が重要です。セキュアコーディングチェックリスト、メンタリングとトレーニング、コーディングとテスティング、構築、展開、構成、運用で開発者の強化を開始します。そして、すべてのセキュリティ管理策が存在し機能していることを確保するために、フォローアップの独立テストで終了します。かつては業界として私たちが行うすべての作業が最後のステップでしたが、開発者が一日に数十回または数百回コードをプロダクションにプッシュするようになると、それだけでは不十分です。アプリケーションセキュリティの専門家はアジャイル技法に遅れずついていく必要があります。つまり、開発者ツールを採用し、コードを学び、開発者と協力することを意味します。他の全員が異動してから何か月も後にプロジェクトを批判するのではありません。
-->

## V1.1 セキュアソフトウェア開発ライフサイクル

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.1.1** | [削除, スコープ外] | | | | |
| **1.1.2** | [削除, スコープ外] | | | | |
| **1.1.3** | [削除, スコープ外] | | | | |
| **1.1.4** | [削除, スコープ外] | | | | |
| **1.1.5** | [1.14.7 へ移動] | | | | |
| **1.1.6** | [削除, 不十分な影響] | | | | | |
| **1.1.7** | [削除, スコープ外] | | | | |

## V1.2 認証ドキュメント

<!--
認証システムを設計する際、攻撃者がコールセンターに電話して一般的に知らせている質問に答えることで簡単にアカウントをリセットできる場合、ハードウェア対応の多要素認証の強度は関係なくなります。セキュアな ID 認証を確保するには、すべての認証経路が同等の強度を備えなければなりません。
-->

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.2.1** | [14.6.2 へ移動] | | | | |
| **1.2.2** | [削除, 2.10.1 へマージ] | | | | |
| **1.2.3** | [削除, 1.2.4 と重複] | | | | |
| **1.2.4** | [修正, 2.2.11 へ分割] アプリケーションに複数の認証経路がある場合、それらすべてに一貫して適用されるべきセキュリティ制御と認証強度がともに文書化されている。 | | ✓ | ✓ | 306 |
| **1.2.5** | [追加] コンテキスト固有の単語のリストが文書化されており、パスワードでの使用を防いでいる。 | | ✓ | ✓ | 521 |

## V1.3 セッション管理ドキュメント

セッション管理メカニズムは、アプリケーションがステートレスな通信プロトコルを使用している場合でも、時間の経過とともにユーザとデバイスのインタラクションを関連付けることができます。現代のアプリケーションでは、異なる特性と目的を持つ複数のセッション識別子やトークンを利用することがあります。安全なセッション管理システムとは、攻撃者が被害者のセッションを取得、利用、あるいは悪用することを適切に防止するものです。

すべてのアプリケーションに適した単一のパターンはありません。したがって、すべてのケースに適した普遍的な境界と制限を定義することは不可能です。実装とテストの前提条件として、セッション処理に関連するセキュリティ上の決定を文書化したリスク分析を実施しなければなりません。これにより、セッション管理システムがアプリケーションの特定の要件に調整されます。ステートフルと「ステートレス」のどちらのセッションメカニズムを選択するかに関わらず、選択されたソリューションが関連するすべてのセキュリティ要件を満たすことができることを示すために、分析を完了して文書化しなければなりません。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.3.1** | [追加] ユーザのセッション非アクティブ期間と再認証前の最大セッション有効期間が文書化され、他のコントロールと組み合わせて適切であり、そのドキュメントには NIST SP 800-63B 再認証要件からの逸脱の正当性が含まれている。 | ✓ | ✓ | ✓ | |
| **1.3.2** | [追加] ドキュメントには、一つのアカウントで許可される同時 (並列) セッションの数と、アクティブセッションの最大数に達した場合に実行される意図した動作やアクションを定義している。 | ✓ | ✓ | ✓ | |

## V1.4 アクセス制御ドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.4.1** | [削除, 4.1.1 と重複] | | | | |
| **1.4.2** | [削除] | | | | |
| **1.4.3** | [削除, 4.1.3 と重複] | | | | |
| **1.4.4** | [削除, 不十分な影響] | | | | |
| **1.4.5** | [削除, 不十分な影響] | | | | |
| **1.4.6** | [追加] アプリケーションドキュメントでは、ユーザの通常の環境属性とコンテキスト属性 (時間帯、場所、IP アドレス、デバイスなど) の変更を使用して、認証と認可に関連するものを含め、セキュリティ上の決定を行うコントロールを定義している。これらの変更は、ユーザが新しいセッションを開始しようとするときと、既存のセッションの経過中の両方で検出される必要がある。 | | | ✓ | |
| **1.4.7** | [追加] アクセス制御ドキュメントはアクセス制御の意思決定のルールを定義し、ユーザとサブジェクトの属性、リソース属性、そのプロセスに関連する環境要因を指定している。 | ✓ | ✓ | ✓ | |

## V1.5 入力および出力ドキュメント

<!--
4.0 では、意味のある信頼境界線の用語として「サーバサイド」という用語をなくしました。信頼境界線は依然として重要です。信頼できないブラウザやクライアントデバイスでの決定はバイパス可能です。しかし、今日の主流のアーキテクチャ展開では、信頼の実行点が劇的に変わりました。したがって、ASVS で「信頼できるサービスレイヤ」という用語が使用されている場合、マイクロサービス、サーバレス API、サーバサイド、セキュアブートを備えたクライアントデバイス上の信頼された API、パートナーAPI や外部 API など、場所に関係なく、信頼された実行点を意味します。

ここでの「信頼できないクライアント」という用語はプレゼンテーション層を提供するクライアントサイドのテクノロジを指し、一般に「フロントエンド」テクノロジと呼ばれます。この文脈での「シリアライゼーション」という用語は値の配列などをネットワーク経由でデータを送信することや JSON 構造体を処理することだけでなく、ロジックを含む可能性のある複雑なオブジェクトの処理も意味します。
-->

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.5.1** | [修正, 1.5.5 へ分割, レベル L2 > L1] 入力バリデーションルールは期待される構造に対するデータ項目の妥当性をチェックする方法を定義している。これは、クレジットカード番号、電子メールアドレス、電話番号のような一般的なデータ形式のこともあれば、内部データ形式のこともある。 | ✓ | ✓ | ✓ | 20 |
| **1.5.2** | [削除, 5.5.3 へマージ] | | | | |
| **1.5.3** | [5.6.2 へ移動] | | | | |
| **1.5.4** | [5.6.3 へ移動] | | | | |
| **1.5.5** | [追加, 1.5.1 から分割] 入力バリデーションルールは文書化され、地区と郵便番号が一致することをチェックするなど、組み合わされたデータ項目の論理的およびコンテキスト的な一貫性を確保する方法を定義している。 | ✓ | ✓ | ✓ | 20 |

## V1.6 暗号ドキュメント

アプリケーションは分類に従ってデータ資産を保護するために、強力な暗号化アーキテクチャで設計する必要があります。すべてを暗号化することは無駄であり、なにも暗号化しないことは法的な過失となります。通常、アーキテクチャ設計や高レベル設計、デザインスプリントやアーキテクチャスパイクの際に、バランスをとる必要があります。暗号を自ら設計したり追加導入したりすることは、最初から単純に組み込むよりも、セキュアに実装するために必然的により多くのコストがかかります。

アーキテクチャ要件はコードベース全体に内在するため、単体テストや統合テストは困難です。アーキテクチャ要件はコーディングフェーズを通じてコーディング標準を考慮する必要があり、セキュリティアーキテクチャ、ピアレビューやコードレビュー、振り返りの際にレビューする必要があります。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.6.1** | 暗号鍵の管理に関する明示的なポリシーがあり、暗号鍵のライフサイクルが NIST SP 800-57 などの鍵管理標準に従っている。 | | ✓ | ✓ | 320 |
| **1.6.2** | 暗号化サービスの利用者が、Key Vault または API ベースの代替手段を使用して、キーマテリアルおよびその他の秘密情報を保護している。 | | ✓ | ✓ | 320 |
| **1.6.3** | すべての鍵とパスワードが置き換え可能であり、機密データを再暗号化するため明確に定義されたプロセスの一部となっている。 | | ✓ | ✓ | 320 |
| **1.6.4** | [文法] アーキテクチャがクライアントサイドの秘密情報 (対称鍵、パスワード、API トークンなど) を安全でないものとして扱い、機密データの保護やアクセスにそれらを使用していない。 | | ✓ | ✓ | 320 |

## V1.7 エラー、ロギング、監査ドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.7.1** | [7.1.7 へ移動] | | | | |
| **1.7.2** | [7.3.5 へ移動] | | | | |
| **1.7.3** | [追加] アプリケーションのテクノロジスタックの各レイヤで実行されるログ記録、ログ記録されるイベント、ログ形式、ログ記録の保存場所、ログ記録の使用方法、ログ記録へのアクセスコントロール方法、ログの保存期間を文書化したインベントリが存在している。 | | ✓ | ✓ | 778 |

## V1.8 データ保護とプライバシードキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.8.1** | [修正, 8.3.4 からマージ, レベル L2 > L1] アプリケーションにより作成および処理されるすべての機密データが特定され、保護レベルに分類されている。機密データの取り扱い方法に関するポリシーが整備されている。これは Base64 や JWT などの復元可能な形式でエンコードされている機密データを含むことに注意する。 | ✓ | ✓ | ✓ | 213 |
| **1.8.2** | [修正, 8.1.9 へ分割] 文書化された保護要件一式がすべての保護レベルにある。これには一般的な暗号化、完全性検証、リテンション、データのログ記録方法、ログ内の機密データに関するアクセス制御、データベースレベルの暗号化、プライバシー、使用されるプライバシー強化技法に関連する要件、およびその他の機密性要件が含まれている (ただし、これらに限定されない) 。 | | ✓ | ✓ | |

## V1.9 通信ドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.9.1** | [削除, 9.1.1, 9.2.2, 9.3.1 と重複] | | | | |
| **1.9.2** | [削除, 9.2.3, 9.3.2 と重複] | | | | |

## V1.10 セキュアコーディングドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.10.1** | [削除, スコープ外] | | | | |
| **1.10.2** | [修正, 14.2.5 から移動, 14.2.4 からマージ] 使用しているすべてのサードパーティライブラリについて、ソフトウェア部品表 (SBOM) などのインベントリカテゴリを保守している。コンポーネントは事前定義済みで信頼でき、継続的に保守されているリポジトリから取得している。 | | ✓ | ✓ | |

## V1.11 ビジネスロジックドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.11.1** | [削除, スコープ外] | | | | |
| **1.11.2** | [削除, 11.1.6 へマージ] | | | | |
| **1.11.3** | [削除, 11.1.6 へマージ] | | | | |
| **1.11.4** | [追加] ビジネスロジックの制限とバリデーションに対する期待は、ユーザーごと、およびアプリケーション全体にもわたって明確に文書化されている。 | | ✓ | ✓ | |

## V1.12 セキュアファイルアップロードドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.12.1** | [削除, 12.4.1 と重複] | | | | |
| **1.12.2** | [削除, 50.5.2 へマージ] | | | | |
| **1.12.3** | [追加] アプリケーションがファイルのアップロードを許可している場合、ドキュメントでは各アップロード機能で許可されるファイルタイプ、想定されるファイル拡張子、最大サイズ (展開後のサイズを含む) を定義している。さらに、ドキュメントにはエンドユーザがファイルをダウンロードして処理する際に安全を確保する方法を指定している。 | ✓ | ✓ | ✓ | |

## V1.13 API と Web サービスのドキュメント

これは将来のドキュメント要件のためのプレースホルダです。

## V1.14 コンフィギュレーションドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.14.1** | [削除, スコープ外] | | | | |
| **1.14.2** | [削除, スコープ外] | | | | |
| **1.14.3** | [削除, 14.2.1 と重複] | | | | |
| **1.14.4** | [削除, スコープ外] | | | | |
| **1.14.5** | [10.5.1 へ移動] | | | | |
| **1.14.6** | [50.7.2 へ移動] | | | | |
| **1.14.7** | [修正, 1.1.5 から移動] アプリケーションのすべての通信が文書化されている。これには、アプリケーションが依存する外部サービスや、アプリケーションが接続する外部ロケーションをエンドユーザが提供できる可能性がある場合が含まれる。 | | ✓ | ✓ | 1059 |

## V1.50 Web フロントエンドセキュリティドキュメント

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.50.1** | [追加] アプリケーションドキュメントには、アプリケーションを使用するブラウザがサポートする必要がある想定されるセキュリティ機能 (HTTPS、HSTS、コンテンツセキュリティポリシー (CSP)、その他の関連する HTTP セキュリティメカニズムなど) を記載している。これらの機能の一部が利用できない場合にアプリケーションがどのように動作しなければならないか (ユーザへの警告やアクセスのブロックなど) も定義する必要がある。| | | ✓ | |

## 参考情報

詳しくは以下の情報を参照してください。

* [OWASP Threat Modeling Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Threat_Modeling_Cheat_Sheet.html)
* [OWASP Attack Surface Analysis Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Attack_Surface_Analysis_Cheat_Sheet.html)
* [OWASP Threat modeling](https://owasp.org/www-community/Application_Threat_Modeling)
* [OWASP Software Assurance Maturity Model Project](https://owasp.org/www-project-samm/)
* [Microsoft SDL](https://www.microsoft.com/en-us/securityengineering/sdl/)
* [NIST SP 800-57](https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final)
* [More information on security.txt including a link to the RFC](https://securitytxt.org/)
