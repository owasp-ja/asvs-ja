# V11 ビジネスロジック

## 管理目標

検証対象のアプリケーションが以下の上位要件を満たすことを確認します。

* ビジネスロジックが正しい順序で処理
* ビジネスロジックに自動攻撃を検知し防止する制限とコントロールが実装されている。自動攻撃の例としては，連続的な少額の送金や 1 度に 100 万人の友人を追加する，がある
* 高い価値を持つビジネスロジックにおいて悪用ケースや悪用する人を想定している。また，なりすまし (spoofing)，改ざん (tampering)，情報の漏えい (information disclosure)，権限昇格 (elevation of privilege) 攻撃の対策を行っている

## V1.11 ビジネスロジックドキュメント

| # | 説明 | レベル | CWE |
| :---: | :--- | :---: | :---: |
| **1.11.1** | [削除, スコープ外] | | |
| **1.11.2** | [10.7.2 へ移動] | | |
| **1.11.3** | [10.7.1 へ移動] | | |
| **1.11.4** | [追加] ビジネスロジックの制限とバリデーションに対する期待は、ユーザーごと、およびアプリケーション全体にもわたって明確に文書化されている。 | 2 | |
| **1.11.5** | [追加, 1.5.1 から分割, レベル L2 > L1] 入力バリデーションルールは期待される構造に対するデータ項目の妥当性をチェックする方法を定義している。これは、クレジットカード番号、電子メールアドレス、電話番号のような一般的なデータ形式のこともあれば、内部データ形式のこともある。 | 1 | 20 |
| **1.11.6** | [追加, 1.5.1 から分割, レベル L2 > L1] 入力バリデーションルールは文書化され、地区と郵便番号が一致することをチェックするなど、組み合わされたデータ項目の論理的およびコンテキスト的な一貫性を確保する方法を定義している。 | 1 | 20 |

## V11.1 ビジネスロジックのセキュリティ

ビジネスロジックセキュリティは、すべてのアプリケーションごとに固有なため、どのチェックリストも適用はできません。そして外部からの脅威から保護するようにシステム内に設計されている必要がありますが、それは Web アプリケーションファイアウォール (firewalls) や安全な通信を使用しても保護することはできません。

| # | 説明 | レベル | CWE |
| :---: | :--- | :---: | :---: |
| **11.1.1** | アプリケーションが同じユーザのビジネスロジックフローを手順通り、省略せずに処理する。 | 1 | 841 |
| **11.1.2** | [11.2.1 へ移動] | | |
| **11.1.3** | [修正, 11.1.5 からマージ] ビジネスロジックの制限とバリデーションはアプリケーションのドキュメントに従って実装され、負の数量でアイテムを購入するなどのビジネスロジックの欠陥が悪用されることを避けている。 | 1 | |
| **11.1.4** | [11.2.2 へ移動] | | |
| **11.1.5** | [削除, 11.1.3 へマージ] | | |
| **11.1.6** | [10.7.3 へ移動] | | |
| **11.1.7** | [7.2.4 へ移動] | | |
| **11.1.8** | [7.2.5 へ移動] | | |
| **11.1.9** | [追加] "アトミックトランザクション" はビジネスロジックレベルで使用されてビジネスロジックオペレーション全体が成功するか、以前の正しい状態にロールバックされる。 | 2 | |
| **11.1.10** | [追加] 非常に価値の高いロジックフローは複数ユーザの承認で制限され、認可されていないアクションや偶発的なアクションを防いでいる。これには、多額の送金、契約の承認、重要な原子力施設操作へのアクセス、医療記録の変更、機密情報へのアクセス、製造における安全のオーバーライドなどが含まれるが、これらに限定されない。 | 3 | |

## V11.2 アンチオートメーション

| # | 説明 | レベル | CWE |
| :---: | :--- | :---: | :---: |
| **11.2.1** | [修正, 11.1.2 から移動, レベル L1 > L3] ビジネスロジックプロセスは現実的な人間のタイミングを必要とし、過度に迅速なトランザクション送信を防いでいる。 | 3 | 799 |
| **11.2.2** | [修正, 11.1.4 から移動, レベル L1 > L2] アンチオートメーションコントロールが導入され、データ流出、ガベージデータ作成、クォータ枯渇、レート制限違反、サービス拒否、高価なリソースの過剰使用につながる可能性のあるアプリケーション機能への過剰な呼び出しから保護している。 | 2 | 770 |

## V11.3 入力バリデーション

| # | 説明 | レベル | CWE |
| :---: | :--- | :---: | :---: |
| **11.3.1** | [修正, 5.1.3 から移動] ビジネス上やセキュリティ上の決定を行うために使用される入力は、その入力に対するビジネス上や機能上の期待を強制するために、許可された値、パターン、範囲のリストに照らして、ポジティブバリデーションを使用して検証される。L2 では、入力バリデーションはグローバルに実装されるべきである。 | 1 | 20 |
| **11.3.2** | [追加, 5.1.4 から分割] 期待される構造を備え、ビジネス上やセキュリティ上の決定を行うために使用されるデータ項目は、事前に定義されたルールに従って検証される。L2 では、入力バリデーションはグローバルに実装されなければならない。 | 1 | 20 |
| **11.3.3** | [追加, 5.1.4 から分割, レベル L1 > L2] アプリケーションは、関連するデータ項目の組み合わせが事前に定義されたルールに従って妥当であることを確保している。 | 2 | 20 |
| **11.3.4** | [修正, 1.5.3 から移動, レベル L2 > L1] アプリケーションは信頼できるサービスレイヤで入力バリデーションを実行するように設計されている。クライアントサイドのバリエーションはユーザービリティを向上するが、セキュリティコントロールとしては依存してはならない。 | 1 | 602 |

## 参考情報

詳しくは以下の情報を参照してください。

* [OWASP Web Security Testing Guide 4.2: Business Logic Testing](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/10-Business_Logic_Testing/README)
* 対自動処理はこれらを含む、多くの方法で対応できる。 [OWASP Automated Threats to Web Applications](https://owasp.org/www-project-automated-threats-to-web-applications/)
