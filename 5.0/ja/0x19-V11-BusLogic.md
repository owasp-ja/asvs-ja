# V11 ビジネスロジック

## 定義

アプリケーションセキュリティにおけるビジネスロジックとは、アプリケーションの特定の要件や、アプリケーションが提供するビジネスのニーズに応じて、アプリケーションを保護するカスタマイズされたルールとプロセスを指します。これらのルールは、ユーザインタラクション、データ処理、システム動作など、さまざまな側面を規定し、各アプリケーション、ビジネス、業界の固有の特定に合わせて調整されます。

ビジネスロジックの脆弱性の例をいくつかあげます。

### 例 1

* ビジネスルール: 詐欺や未払いによる損失を防ぐため、トランザクションが正常に検証された後にのみ、商品を顧客に提供する必要があります。
* 脆弱性: 攻撃者がアプリケーションを操作して、購入が検証される前に製品を届けることができれば、支払いを受けずに商品を提供し、ビジネスに金銭的損失をもたらすリスクがあります。

### 例 2

* **ビジネスルール:** 特定の閾値以上の高額トランザクションは、正確性、正当性、ビジネスポリシーへの準拠を確保するために、手動でレビューする必要があります。
* **脆弱性:** 攻撃者がアプリケーションを操作して高額トランザクションのレビュープロセスをスキップできれば、不正または誤ったトランザクションが気付かれず、金銭的損失やコンプライアンス違反のリスクが高まるかもしれません。

## 管理目標

検証対象のアプリケーションが以下の上位要件を満たすことを確認します。

* ビジネスロジックが正しい順序で処理
* ビジネスロジックに自動攻撃を検知し防止する制限とコントロールが実装されている。自動攻撃の例としては，連続的な少額の送金や 1 度に 100 万人の友人を追加する，がある
* 高い価値を持つビジネスロジックにおいて悪用ケースや悪用する人を想定している。また，なりすまし (spoofing)，改ざん (tampering)，情報の漏えい (information disclosure)，権限昇格 (elevation of privilege) 攻撃の対策を行っている

## V11.1 ビジネスロジックのセキュリティ

ビジネスロジックセキュリティは、すべてのアプリケーションごとに固有なため、どのチェックリストも適用はできません。そして外部からの脅威から保護するようにシステム内に設計されている必要がありますが、それは Web アプリケーションファイアウォール (firewalls) や安全な通信を使用しても保護することはできません。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **11.1.1** | アプリケーションが同じユーザのビジネスロジックフローを手順通り、省略せずに処理する。 | ✓ | ✓ | ✓ | 841 |
| **11.1.2** | [11.2.1 へ移動] | | | | |
| **11.1.3** | [修正, 11.1.5 からマージ] ビジネスロジックの制限とバリデーションはアプリケーションのドキュメントに従って実装される。 | ✓ | ✓ | ✓ | |
| **11.1.4** | [11.2.2 へ移動] | | | | |
| **11.1.5** | [削除, 11.1.3 へマージ] | | | | |
| **11.1.6** | [修正] アプリケーションは内部データの一貫性を保ち、ユーザーの状態を維持し、'time of check to time of use (TOCTOU)' 脆弱性などの競合状態を防ぐために、機密性の高い操作に対して同期およびロックのメカニズムを使用する。 | | ✓ | ✓ | 367 |
| **11.1.7** | [7.2.4 へ移動] | | | | |
| **11.1.8** | [7.2.5 へ移動] | | | | |
| **11.1.9** | [追加] "アトミックトランザクション" はビジネスロジックレベルで使用されてビジネスロジックオペレーション全体が成功するか、以前の正しい状態にロールバックされる。 | | ✓ | ✓ | |

## V11.2 アンチオートメーション

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **11.2.1** | [11.1.2 から移動] アプリケーションは、すべてのステップが人間の実際に処理する時間で処理されたビジネスロジックフローのみ処理する。（送信されるのが早すぎるトランザクションは処理されない。） | ✓ | ✓ | ✓ | 799 |
| **11.2.2** | [修正, 11.1.4 から移動] 大量のデータ流出、ジャンクデータ作成、リソースクォータの枯渇、レート制限違反、経路外通信のフラッディング、サービス拒否、高価なリソースの過剰使用などを引き起こす可能性のあるアプリケーション機能への過剰な呼び出しから保護するために、アプリケーションに自動攻撃を防止する制限がある。 | ✓ | ✓ | ✓ | 770 |

## 参考情報

詳しくは以下の情報を参照してください。

* [OWASP Web Security Testing Guide 4.2: Business Logic Testing](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/10-Business_Logic_Testing/README)
* 対自動処理はこれらを含む、多くの方法で対応できる。 [OWASP Automated Threats to Web Applications](https://owasp.org/www-project-automated-threats-to-web-applications/)
